<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>おっぱい曲線 - D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        .slider-container { margin: 10px; }
        svg { background-color: white; display: block; margin: auto; }
    </style>
</head>
<body>
    <h2>おっぱい曲線</h2>
    <div class="slider-container">
        <label for="topUnder">トップアンダー: </label>
        <input type="range" id="topUnder" min="10" max="70" step="1" value="35">
        <span id="topUnderValue">35</span>
    </div>
    <div class="slider-container">
        <label for="D">離れ度: </label>
        <input type="range" id="D" min="0.5" max="1.5" step="0.01" value="1">
        <span id="DValue">1</span>
    </div>

    <svg width="600" height="500"></svg>

    <script>
        const svg = d3.select("svg"),
              width = +svg.attr("width"),
              height = +svg.attr("height"),
              margin = { top: 30, right: 30, bottom: 30, left: 30 };

        const xScale = d3.scaleLinear().domain([-13, 13]).range([margin.left, width - margin.right]);
        const path = svg.append("path").attr("fill", "pink").attr("stroke", "pink");

        function update() {
            const topUnder = +document.getElementById("topUnder").value;
            const D = +document.getElementById("D").value;
            document.getElementById("topUnderValue").innerText = topUnder;
            document.getElementById("DValue").innerText = D;

            const oppai = topUnder / (4 * Math.PI);
            const theta = d3.range(-2 * Math.PI, 2 * Math.PI, 0.01); // データ数を削減

            // 事前に maxX を計算しておく（無駄な計算を削減）
            const maxX = Math.max(...theta.map(t => t - Math.sin(D * t)));
            const x = theta.map(t => (t - Math.sin(D * t)) / maxX * 13);
            const y = theta.map(t => oppai * (1 - Math.cos(t)));

            const yMax = 2 * oppai + 3;
            const yScale = d3.scaleLinear().domain([0, yMax]).range([height - margin.bottom, margin.top]);

            const line = d3.line()
                .x((d, i) => xScale(x[i]))
                .y((d, i) => yScale(y[i]));

            // 全削除せずに、path を更新するだけ
            path.attr("d", line(y));
        }

        document.getElementById("topUnder").addEventListener("input", update);
        document.getElementById("D").addEventListener("input", update);

        update();
    </script>
</body>
</html>

